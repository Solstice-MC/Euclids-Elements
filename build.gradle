plugins {
	id 'fabric-loom' version '1.10-SNAPSHOT'
	id 'maven-publish'
}

base.archivesName = mod_id
group = mod_group
version = mod_version

sourceSets {
	testmod {
		compileClasspath += main.compileClasspath
		runtimeClasspath += main.runtimeClasspath
	}
}

loom {
	mods {
		"euclids-elements" {
			sourceSet sourceSets.main
		}
		"tabula" {
			sourceSet sourceSets.main
			sourceSet sourceSets.testmod
		}
	}
}

dependencies {
	minecraft "com.mojang:minecraft:$minecraft_version"
	mappings "net.fabricmc:yarn:$yarn_mappings:v2"
	modImplementation "net.fabricmc:fabric-loader:$loader_version"
	modImplementation "net.fabricmc.fabric-api:fabric-api:$fabric_version"

	testmodImplementation sourceSets.main.output
}

fabricApi {
	configureDataGeneration()
}

loom {
	accessWidenerPath = file("src/main/resources/${mod_id}.accesswidener")
	runs {
		datagen {
			source sourceSets.testmod
			name "Minecraft Datagen"
		}
		client {
			source sourceSets.testmod
			name "Minecraft Client"
		}
		server {
			source sourceSets.testmod
			name "Minecraft Server"
		}
	}
	createRemapConfigurations(sourceSets.testmod)
}

processResources {
//	duplicatesStrategy = DuplicatesStrategy.EXCLUDE
//	filesMatching("fabric.mod.json") {
//		expand "mod_version": mod_version
//	}
}

publishing {
	publications {
		create("mavenJava", MavenPublication) {
			from components.java
		}
	}
}
tasks.build.finalizedBy publishToMavenLocal
